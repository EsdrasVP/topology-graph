/*! topology-graph 02-06-2015 */
module.exports=function(a){a.initConfig({pkg:a.file.readJSON("package.json"),concat:{options:{separator:";"},dist:{src:["*.js"],dest:"dist/topology-graph.js"}},uglify:{options:{banner:'/*! <%= pkg.name %> <%= grunt.template.today("dd-mm-yyyy") %> */\n'},dist:{files:{"dist/topology-graph.min.js":["<%= concat.dist.dest %>"]}}},qunit:{files:["test/**/*.html"]},jshint:{files:["Gruntfile.js","src/**/*.js","test/**/*.js"],options:{globals:{define:!0,console:!0,document:!0}}},watch:{files:["<%= jshint.files %>"],tasks:["jshint","qunit"],css:{files:"topology-graph.css"},js:{files:["topology-graph.js","topology-graph.css","index.html"],tasks:["build"]}},connect:{options:{protocol:a.option("scheme")||"http",port:a.option("port")||9e3,hostname:a.option("hostname")||"localhost"},server:{}},run:{bower:{cmd:"node_modules/.bin/bower",args:["update"]}}}),a.loadNpmTasks("grunt-contrib-connect"),a.loadNpmTasks("grunt-contrib-jshint"),a.loadNpmTasks("grunt-contrib-watch"),a.loadNpmTasks("grunt-contrib-concat"),a.loadNpmTasks("grunt-contrib-uglify"),a.loadNpmTasks("grunt-run"),a.registerTask("serve",["build","connect:server","watch"]),a.registerTask("build",["concat","uglify","jshint"]),a.registerTask("default",["serve"]),a.registerTask("bower",["run:bower"])},function(a,b){"function"==typeof define&&define.amd?define(["./angular","./d3"],b):b(a.angular,a.d3)}(this,function(a,b){"use strict";function c(a,c){function d(a){var b;return m&&(b=m[a.kind]),b||""}function e(a){return a.status&&a.status.phase&&"Running"!==a.status.phase?!0:!1}function f(){s.size([j,k]),u.attr("width",j).attr("height",k),g()}function g(){w=u.selectAll("line").data(q),w.exit().remove(),w.enter().insert("line",":first-child"),w.attr("class",function(a){return a.kinds}),v=u.selectAll("g").data(p,function(a){return a.id}).classed("weak",e),v.exit().remove();var a=v.enter().append("g").attr("class",function(a){return a.kind}).classed("weak",e).call(t);a.append("circle").attr("r",15),a.append("text").attr("y",6).text(d),a.append("title").text(function(a){return a.metadata.name}),s.nodes(p).links(q).start()}function h(){var a=p,b=r;p=[],q=[],r={};var c,d,e,f;for(d in n)c=n[d],e=c.kind,c.id=d,(!m||m[e])&&(f=a[b[d]],f&&(c.x=f.x,c.y=f.y,c.px=f.px,c.py=f.py,c.fixed=f.fixed,c.weight=f.weight),r[d]=p.length,p.push(c));var h,i,j,k,l;for(h=0,i=o.length;i>h;h++)j=o[h],k=r[j.source],l=r[j.target],void 0!==k&&void 0!==l&&q.push({source:k,target:l,kinds:m});g()}function i(){j=l.node().clientWidth,k=window.innerHeight-15,f()}var j,k,l=b.select(a),m=null,n={},o=[],p=[],q=[],r={},s=b.layout.force().charge(-800).gravity(.2).linkDistance(80),t=s.drag(),u=l.append("svg").attr("class","kube-topology"),v=b.select(),w=b.select();return s.on("tick",function(){w.attr("x1",function(a){return a.source.x}).attr("y1",function(a){return a.source.y}).attr("x2",function(a){return a.target.x}).attr("y2",function(a){return a.target.y}),v.attr("transform",function(a){return"translate("+a.x+","+a.y+")"})}),t.on("dragstart",function(a){c(a),u.selectAll("g").classed("selected",!1),b.select(this).classed("selected",!0),a.fixed!==!0&&(a.floatpoint=[a.x,a.y]),a.fixed=!0,b.select(this).classed("fixed",!0)}).on("dragend",function(a){var c=!0;a.floatpoint&&(c=a.x<a.floatpoint[0]-5||a.x>a.floatpoint[0]+5||a.y<a.floatpoint[1]-5||a.y>a.floatpoint[1]+5,delete a.floatpoint),a.fixed=c&&a.x>3&&a.x<j-3&&a.y>=3&&a.y<k-3,b.select(this).classed("fixed",a.fixed)}),u.on("dblclick",function(){u.selectAll("g").classed("fixed",!1).each(function(a){a.fixed=!1})}).on("click",function(a){b.select(b.event.target).datum()||(c(null),u.selectAll("g").classed("selected",!1))}),window.addEventListener("resize",i),i(),{kinds:function(a){return 0===arguments.length?m:(m=a,void h())},data:function(a,b){return 0===arguments.length?[n,o]:(n=a||{},o=b||[],void h())},close:function(){window.removeEventListener("resize",i)}}}try{a.module("kubernetesUI")}catch(d){a.module("kubernetesUI",[])}return a.module("kubernetesUI").directive("kubernetesTopologyGraph",[function(){return{restrict:"E",scope:{items:"=",relations:"=",kinds:"="},link:function(a,b,d){function e(b){a.$emit("selected",b)}b.css("display","block");var f=c(b[0],e);f.kinds(a.kinds),a.$watchCollection("kinds",function(a){f.kinds(a)}),a.$watchGroup(["items","relations"],function(a){f.data(a[0],a[1])}),b.on("$destroy",function(){f.close()})}}}])});